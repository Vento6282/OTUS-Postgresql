# Сбор и использование статистики .

Занятие от 20.06.2024

## Выполнение домашнего задания:

 - Реализовать прямое соединение двух или более таблиц

Текст запроса:
```
select bp.flight_id, count(*) qty_tickets
from boarding_passes bp 
    inner join ticket_flights tf on bp.ticket_no = tf.ticket_no and bp.flight_id = tf.flight_id 
group by bp.flight_id limit 10;
```
Вывод результата запроса:
```
 flight_id | qty_tickets
-----------+-------------
         2 |          94
         3 |          97
         7 |         101
         8 |          94
         9 |         116
        10 |          95
        11 |         100
        12 |          91
        14 |          97
        15 |          90
```
 - Реализовать левостороннее (или правостороннее) соединение двух или более таблиц

Текст запроса:
```
select ad.*
from aircrafts_data ad
    left join flights f on ad.aircraft_code = f.aircraft_code
where f.aircraft_code is null
group by ad.aircraft_code;
```
Вывод результата запроса:
```
 aircraft_code |                        model                        | range
---------------+-----------------------------------------------------+-------
 320           | {"en": "Airbus A320-200", "ru": "Аэробус A320-200"} |  5700
```

 - Реализовать кросс соединение двух или более таблиц

Текст запроса:
 ```
select concat(ad1.airport_code, ' ' ,ad1.city ->> 'ru') as city_out, concat(ad2.airport_code, ' ' ,ad2.city ->> 'ru') as city_in 
from airports_data ad1 
    cross join airports_data ad2 
where ad1.airport_code != ad2.airport_code
limit 10;
```
Вывод результата запроса:
```
  city_out  |           city_in
------------+------------------------------
 YKS Якутск | MJZ Мирный
 YKS Якутск | KHV Хабаровск
 YKS Якутск | PKC Петропавловск-Камчатский
 YKS Якутск | UUS Южно-Сахалинск
 YKS Якутск | VVO Владивосток
 YKS Якутск | LED Санкт-Петербург
 YKS Якутск | KGD Калининград
 YKS Якутск | KEJ Кемерово
 YKS Якутск | CEK Челябинск
 YKS Якутск | MQF Магнитогорск
```
 - Реализовать полное соединение двух или более таблиц

Текст запроса:
```
select coalesce (d.name, '<без автора>') director, coalesce (f.name, '<нет фильма>') film
from directors d full join films f on d.id = f.id_director
order by d.name;
```
Вывод результата запроса:
```
    director     |         film
-----------------+----------------------
 Джеймс Кемерон  | Титаник
 Мартин Скорсезе | Славные парни
 Никита Михалков | <нет фильма>
 Стивен Спилберг | Парк юрского периода
 <без автора>    | Выживший
```
 - Реализовать запрос, в котором будут использованы разные типы соединений

Текст запроса:
```
select passenger_name
from bookings b 
	inner join tickets t on b.book_ref = t.book_ref
	left join boarding_passes bp on t.ticket_no = bp.ticket_no 
where bp.ticket_no is null
limit 10;
```
Вывод результата запроса:
```
   passenger_name
--------------------
 ANNA BORISOVA
 EGOR NIKOLAEV
 SERGEY VOLKOV
 VLADIMIR AFANASEV
 TATYANA KISELEVA
 SVETLANA LUKYANOVA
 SERGEY MOROZOV
 ALEKSANDR MAKSIMOV
 NIKOLAY FOMIN
 LIDIYA CHERNOVA
```
 - Сделать комментарии на каждый запрос

***Inner join***\
Запрос выводит количество пассажиров, прошедших на посадку на рейсы. В запросе для соединения таблиц *boarding_passes* и *ticket_flights* используется прямое соединение. Значения **null** будут не удовлетворять условиям и в результирующий набор данных не попадут. Соединение происходит при равенстве значений, указанных в операторе *ON*.

***Right/left join***\
Запрос выводит модели самолётов, которые не используются в перелётах. В запросе для соединения таблиц *aircrafts_data* и *flights* используется левое соединение. Будут искаться пары для **всех** значений из левой таблицы. Если для левой таблицы не будет найдено соответствий в правой таблицы, то значения правой таблицы будут **null**. Соединение происходит при равенстве значений, указанных в операторе *ON*.

***Full join***\
Для полного соединения не удалось придумать пример в рамках демонстрационной таблицы, поэтому создал свои. Запроса выводит список всех режиссёров и фильмы. Для соединения используем ***full join***, чтобы никакие записи не потерялись. Соединение происходит при равенстве значений, указанных в операторе *ON*. Если у режиссёра в таблице *films* нет фильмов, то выводим значение <нет фильма>, если для фильма нет режиссёра, то в результирующем наборе в строке такого фильма отображаем <нет режиссёра>.

***Cross join***\
Запрос выводит все варианты городов и аэропортов вылета и прилёта. ***Cross join*** соединяет каждую строку из первой таблицы с каждой строкой из второй. Оператор ON в таких соединениях не требуется.

***Разные join'ы***\
Запрос выводит список пассажиров, которые забронировали билеты, но не совершили посадку. Сначала в запросе делаем прямое соеденение, чтобы ограничить список только теми пассажирами, у которых был забронирован билет. Затем делаем левое соединение для определения пассажиров, у которых нет данных о посадке на рейс, то есть у которых в данных правой таблицы есть значение **null**.

 - К работе приложить структуру таблиц, для которых выполнялись соединения

Структура приложена в отдельном файле.

Задание со звездочкой*
 - Придумайте 3 своих метрики на основе показанных представлений, отправьте их через ЛК, а так же поделитесь с коллегами в слаке